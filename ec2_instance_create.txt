//To Tell Terraform Which Cloud We Want To Use

provider "aws" {

region   = "ap-south-1"

profile  = "dinesh97"

}





//Use RSA Algorithm For Key

resource "tls_private_key" "terraos_key" {

  algorithm = "RSA"

}





//Create a Key 

resource "aws_key_pair" "deployment_key" {

  key_name   = "terraos_key"

  public_key = "${tls_private_key.terraos_key.public_key_openssh}"





  depends_on = [

    tls_private_key.terraos_key

  ]

}





//Saving The Key In Local System

resource "local_file" "key-file" {

  content  = "${tls_private_key.terraos_key.private_key_pem}"

  filename = "terraoskey.pem"





  depends_on = [

    tls_private_key.terraos_key

  ]

}





//Creating A New Security Group

resource "aws_security_group" "http_request" {

  name        = "http_request"

  description = "Allow TCP inbound traffic"

  vpc_id      = "vpc-691b0401"



  //Allowing http port

  ingress {

    description = "HTTP from VPC"

    from_port   = 80

    to_port     = 80

    protocol    = "tcp"

    cidr_blocks = ["0.0.0.0/0"]

  }



 //Allowing SSH port

 ingress {

    description = "SSH from VPC"

    from_port   = 22

    to_port     = 22

    protocol    = "tcp"

    cidr_blocks = ["0.0.0.0/0"]

  }

  

    egress {

    from_port   = 0

    to_port     = 0

    protocol    = "-1"

    cidr_blocks = ["0.0.0.0/0"]

  }

 

  tags = {

    Name = "http_request"

  }

}